!function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function t(t){for(var a=1;a<arguments.length;a++){var r=null!=arguments[a]?arguments[a]:{};a%2?e(Object(r),!0).forEach(function(e){n(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function n(e,t,n){return(t=d(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,s,o,i=[],c=!0,u=!1;try{if(s=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(a=s.call(n)).done)&&(i.push(a.value),i.length!==t);c=!0);}catch(e){u=!0,r=e}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw r}}return i}}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function s(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function i(n,a,r,s){var i=a&&a.prototype instanceof u?a:u,l=Object.create(i.prototype);return o(l,"_invoke",function(n,a,r){var s,o,i,u=0,l=r||[],h=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return s=t,o=0,i=e,d.n=n,c}};function p(n,a){for(o=n,i=a,t=0;!h&&u&&!r&&t<l.length;t++){var r,s=l[t],p=d.p,f=s[2];n>3?(r=f===a)&&(i=s[(o=s[4])?5:(o=3,3)],s[4]=s[5]=e):s[0]<=p&&((r=n<2&&p<s[1])?(o=0,d.v=a,d.n=s[1]):p<f&&(r=n<3||s[0]>a||a>f)&&(s[4]=n,s[5]=a,d.n=f,o=0))}if(r||n>1)return c;throw h=!0,a}return function(r,l,f){if(u>1)throw TypeError("Generator is already running");for(h&&1===l&&p(l,f),o=l,i=f;(t=o<2?e:i)||!h;){s||(o?o<3?(o>1&&(d.n=-1),p(o,i)):d.n=i:d.v=i);try{if(u=2,s){if(o||(r="next"),t=s[r]){if(!(t=t.call(s,i)))throw TypeError("iterator result is not an object");if(!t.done)return t;i=t.value,o<2&&(o=0)}else 1===o&&(t=s.return)&&t.call(s),o<2&&(i=TypeError("The iterator does not provide a '"+r+"' method"),o=1);s=e}else if((t=(h=d.n<0)?i:n.call(a,d))!==c)break}catch(t){s=e,o=1,i=t}finally{u=1}}return{value:t,done:h}}}(n,r,s),!0),l}var c={};function u(){}function l(){}function h(){}t=Object.getPrototypeOf;var d=[][a]?t(t([][a]())):(o(t={},a,function(){return this}),t),p=h.prototype=u.prototype=Object.create(d);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,o(e,r,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=h,o(p,"constructor",h),o(h,"constructor",l),l.displayName="GeneratorFunction",o(h,r,"GeneratorFunction"),o(p),o(p,r,"Generator"),o(p,a,function(){return this}),o(p,"toString",function(){return"[object Generator]"}),(s=function(){return{w:i,m:f}})()}function o(e,t,n,a){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}o=function(e,t,n,a){function s(t,n){o(e,t,function(e){return this._invoke(t,n,e)})}t?r?r(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(s("next",0),s("throw",1),s("return",2))},o(e,t,n,a)}function i(e,t,n,a,r,s,o){try{var i=e[s](o),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(a,r)}function c(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var s=e.apply(t,n);function o(e){i(s,a,r,o,c,"next",e)}function c(e){i(s,a,r,o,c,"throw",e)}o(void 0)})}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,d(a.key),a)}}function h(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function d(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=r(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}function p(e,t){if(e){if("string"==typeof e)return f(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}System.register(["./three-legacy-psawgU7Z.js","./gsap-legacy-BnzCqiyA.js"],function(e,o){"use strict";var i,l,d,p,f,m,y,g,v,b,w,x,k,_,E,C,S,L,P,M,O,j,I,A,D,G,T,R,Y,z,X,V,B,K,U,F,N,H,W;return{setters:[function(e){i=e.B,l=e.V,d=e.M,p=e.S,f=e.C,m=e.P,y=e.a,g=e.W,v=e.b,b=e.c,w=e.A,x=e.O,k=e.d,_=e.e,E=e.f,C=e.g,S=e.R,L=e.T,P=e.h,M=e.G,O=e.i,j=e.j,I=e.k,A=e.l,D=e.D,G=e.m,T=e.n,R=e.o,Y=e.p,z=e.q,X=e.r,V=e.s,B=e.t,K=e.u,U=e.E,F=e.I,N=e.v,H=e.w},function(e){W=e.g}],execute:function(){var e=document.createElement("style");e.textContent="@font-face{font-family:Nunito Sans;font-style:normal;font-weight:400;font-display:swap;src:url("+new URL("../fonts/nunito-sans-v18-cyrillic_latin-regular.woff2",o.meta.url).href+') format("woff2")}@font-face{font-family:Nunito Sans;font-style:normal;font-weight:800;font-display:swap;src:url('+new URL("../fonts/nunito-sans-v18-cyrillic_latin-800.woff2",o.meta.url).href+') format("woff2")}@font-face{font-family:blackberry;font-style:normal;font-weight:400;font-display:swap;src:url('+new URL("../fonts/blackberry.woff2",o.meta.url).href+') format("woff2")}:root{--safe-top: env(safe-area-inset-top, 0px);--safe-right: env(safe-area-inset-right, 0px);--safe-bottom: env(safe-area-inset-bottom, 0px);--safe-left: env(safe-area-inset-left, 0px);--color-blue: #009AA9;--color-blue-grad: linear-gradient(1deg, rgba(0, 154, 169, 1) 1%, rgba(122, 202, 214, 1) 100%);--color-yellow-grad: linear-gradient(1deg, rgba(254, 144, 0, 1) 1%, rgba(247, 197, 131, 1) 100%);--color-green-grad: linear-gradient(1deg, rgba(78, 175, 5, 1) 1%, rgba(149, 224, 128, 1) 100%)}*{-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-user-drag:none;touch-action:manipulation;box-sizing:border-box}.lang-toggle img,.scroll-progress__bar{pointer-events:auto}@media (hover: none){*{cursor:default!important}}html,body{width:100%;height:100%;margin:0;padding:0;overflow:hidden;overscroll-behavior:none;background:#1c1d21;font-family:Nunito Sans,Tahoma,sans-serif}body{position:fixed;top:0;right:0;bottom:0;left:0}canvas{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:-1;object-fit:cover;outline:none;touch-action:none!important}.screen.active{opacity:1;visibility:visible}.screen{position:fixed;top:0;right:0;bottom:0;left:0;width:100%;height:100dvh;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(0,0,0,.8);overflow-x:hidden;overflow-y:auto;-webkit-overflow-scrolling:touch;opacity:0;visibility:hidden;transition:opacity .3s ease,visibility .3s;scrollbar-width:none;-ms-overflow-style:none}.screen::-webkit-scrollbar{display:none;width:0;height:0}.main_screen h1{font-family:blackberry,Tahoma,cursive;font-size:clamp(2.5rem,10vw + 2vh,11.25rem);line-height:.85;text-align:center;color:#f76951;letter-spacing:-.02em;max-width:95vw;margin:max(.5rem,var(--safe-top) * .5) auto clamp(1rem,4vh,3rem);text-shadow:.04em .04em .02em rgba(255,255,255,.9),-.03em -.03em .02em rgba(255,255,255,.9);word-wrap:break-word}.main_screen_btns_wrap{display:flex;flex-direction:column;align-items:center;width:100%}.new_game_btn{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;max-width:370px;height:75px;margin-bottom:18px;border:2px solid #6f727d;border-radius:15px;background:var(--color-blue);font-size:22px;font-weight:800;text-transform:uppercase;cursor:pointer;transition:transform .3s ease,box-shadow .3s ease;position:relative}.new_game_btn:hover{transform:translateY(-2px)}.new_game_btn:active{transform:translateY(0);box-shadow:none}.blue_btn{background:var(--color-blue-grad);border:1px solid #007d8c;box-shadow:0 4px #007d8c}.yellow_btn{background:var(--color-yellow-grad);border:1px solid #d96a02;box-shadow:0 4px #d96a02}.green_btn{background:var(--color-green-grad);border:1px solid #3d8903;box-shadow:0 4px #3d8903}.arrow_back{position:absolute;left:-19px;top:21px;width:5px;height:5px;border:8px solid white;border-color:white white transparent transparent;transform:rotate(-135deg)}.arrow_back:before,.arrow_back:after{content:"";display:block;position:absolute;width:0;height:0;border:5px solid}.arrow_back:before{border-color:white transparent transparent white;top:-1px;right:0;transform:rotate(45deg);transform-origin:top right}.arrow_back:after{border-color:transparent white white transparent;top:0;right:-1px;transform:rotate(-45deg);transform-origin:top right}.huds{display:flex;flex-direction:row-reverse;position:fixed;top:20px;right:20px;z-index:10}.huds{position:fixed;top:max(20px,calc(var(--safe-top) + 10px));right:max(20px,calc(var(--safe-right) + 10px));z-index:10}.hud{margin-left:5px;z-index:10;pointer-events:none}.hud--outline{padding:3px 10px 6px;border-radius:10px;border:1px solid rgba(255,255,255,.6);background:rgba(0,0,0,.12);backdrop-filter:blur(4px)}.menu_in_game{display:flex;align-items:flex-start;align-self:flex-start;padding:5px;border-radius:10px;border:1px solid rgba(255,255,255,.4)}.pause_btn_wrap,.sound_btn_wrap{display:flex;justify-content:center;align-items:center;padding:5px 10px;border-radius:6px;margin:5px;cursor:pointer;pointer-events:auto}.pause_btn_wrap{height:100%;background:var(--color-green-grad);border:1px solid #3d8903;box-shadow:0 4px #3d8903}.sound_btn_wrap{background:var(--color-blue-grad);border:1px solid #007d8c;box-shadow:0 4px #007d8c}#nav-icon3{width:30px;height:30px;position:relative;transform:rotate(0);transition:.5s ease-in-out;cursor:pointer}#nav-icon3 span{display:block;position:absolute;height:5px;width:100%;background:#fff;border-radius:9px;opacity:1;left:0;transform:rotate(0);transition:.25s ease-in-out}#nav-icon3 span:nth-child(1){top:3px}#nav-icon3 span:nth-child(2){top:13px}#nav-icon3 span:nth-child(3){top:23px}#nav-icon3.open span:nth-child(1){top:18px;width:0%;left:50%}#nav-icon3.open span:nth-child(2){transform:rotate(45deg)}#nav-icon3.open span:nth-child(3){transform:rotate(-45deg)}#nav-icon3.open span:nth-child(4){top:18px;width:0%;left:50%}.volume-icon{position:relative;width:30px;height:30px}.volume-icon__input{display:none}.volume-icon__input+svg{display:block;fill:none;stroke:#fff;stroke-linecap:round;stroke-linejoin:round;stroke-width:9px;width:100%;height:100%}.volume-icon__input+svg path{animation:var(--name) .5s ease forwards}.volume-icon__input+svg path:nth-child(1){--name: shape-r}.volume-icon__input+svg path:nth-child(2){--name: small-r;stroke-dashoffset:1px}.volume-icon__input+svg path:nth-child(3){--name: large-r;stroke-dashoffset:1px}.volume-icon__input.volume_off+svg path:nth-child(1){--name: shape}.volume-icon__input.volume_off+svg path:nth-child(2){--name: small}.volume-icon__input.volume_off+svg path:nth-child(3){--name: large}.scroll-progress{position:fixed;top:8px;right:3px;bottom:8px;width:4px;border-radius:4px;background:rgba(255,255,255,.18);pointer-events:none;z-index:1000;opacity:0;transition:opacity .25s ease}.scroll-progress.visible{opacity:1}.scroll-progress__bar{position:absolute;left:0;width:100%;border-radius:4px;background:rgba(255,255,255,.75);cursor:grab;touch-action:none}.scroll-progress__bar:active{cursor:grabbing}.loader_screen .surface{position:absolute;left:50%;transform:translate(-50%,-50%);background-color:#fff;width:8rem;height:.7rem;border-radius:1rem;animation:surface-animation .5s linear infinite}.loader_screen .surface>.loader_line{position:absolute;height:100%;width:0%;background:linear-gradient(90deg,#4dffa3,#00c44b);border-radius:999px;box-shadow:0 0 10px rgba(0,255,180,.8);transition:width .8s ease-in-out}.loader_screen .surface span{font-size:26px;padding-top:14px;position:absolute;color:#fff;font-weight:700}.lang-toggle{position:fixed;bottom:20px;left:20px;width:70px;height:38px;background-color:rgba(255,255,255,.25);border-radius:20px;padding:4px;cursor:pointer;z-index:1001}.lang-toggle img{position:absolute;top:4px;width:30px;height:30px;border-radius:50%;object-fit:cover;transition:all .2s ease-in-out}.lang-toggle img.ru{left:4px}.lang-toggle img.us{left:34px;transform:rotate(360deg)}.debug_error_overlay{position:fixed;top:0;right:0;bottom:0;left:0;z-index:10000;background:rgba(0,0,0,.8);color:#ff8080;font-family:monospace;font-size:14px;padding:20px;white-space:pre-wrap;overflow:auto;pointer-events:auto}@keyframes small{0%,30%{stroke-dasharray:0 0 30px 64px}40%{stroke-dashoffset:16px}80%,to{stroke-dashoffset:1px}70%{stroke-dasharray:0 43px 30px 64px}to{stroke-dasharray:0 39px 30px 64px}}@keyframes small-r{0%{stroke-dasharray:0 39px 30px 64px;stroke-dashoffset:1px}70%{stroke-dashoffset:16px}70%,to{stroke-dasharray:0 0 30px 64px}}@keyframes large{0%,30%{stroke-dasharray:0 0 50px 84px}40%{stroke-dashoffset:16px}80%,to{stroke-dashoffset:1px}70%{stroke-dasharray:0 82px 32px 84px}to{stroke-dasharray:0 78px 32px 84px}}@keyframes large-r{0%{stroke-dasharray:0 78px 32px 84px;stroke-dashoffset:1px}70%{stroke-dashoffset:16px}70%,to{stroke-dasharray:0 0 50px 84px}}@keyframes shape{0%{stroke-dasharray:60px 0 184px;stroke-dashoffset:0}70%{stroke-dasharray:63px 51px 184px;stroke-dashoffset:21px}to{stroke-dasharray:59px 47px 184px;stroke-dashoffset:17px}}@keyframes shape-r{0%{stroke-dasharray:59px 47px 184px;stroke-dashoffset:17px}to{stroke-dasharray:60px 0 184px;stroke-dashoffset:0}}@keyframes surface-animation{0%{transform:translate(-50%) rotate(0)}to{transform:translate(-50%) rotate(0)}}@media (max-height: 600px){.main_screen{justify-content:flex-start;padding-top:10px}.main_screen h1{font-size:clamp(1.8rem,8vw + 1vh,3.5rem)}}@media (min-height: 900px){.main_screen h1{margin-top:max(1rem,var(--safe-top) * .7)}}@media screen and (max-device-width: 1024px){body{text-size-adjust:none}.lang-toggle{bottom:10px;left:10px}}\n/*$vite$:1*/',document.head.appendChild(e);var q=function(){return h(function e(t){u(this,e),this.startGameCallback=t,this.ysdk=null,this._setupGlobalErrorListeners()},[{key:"init",value:function(){var e=this;"complete"===document.readyState?this._initYaGames():window.addEventListener("load",function(){e._initYaGames()})}},{key:"showFullscreenAdv",value:function(){this.ysdk&&this.ysdk.adv.showFullscreenAdv({callbacks:{onClose:function(e){},onError:function(e){}}})}},{key:"showRewardedVideo",value:function(e){this.ysdk&&this.ysdk.adv.showRewardedVideo({callbacks:{onOpen:function(){e.onOpen&&e.onOpen()},onRewarded:function(){e.onRewarded&&e.onRewarded()},onClose:function(){e.onClose&&e.onClose()},onError:function(t){console.error("Reward error:",t),e.onError&&e.onError(t)}}})}},{key:"_initYaGames",value:function(){var e=this;"undefined"!=typeof YaGames?YaGames.init().then(function(t){console.log("YaGames SDK initialized"),e.ysdk=t,window.ysdk=t,e.startGameCallback&&e.startGameCallback(t)}).catch(function(t){e.showInitError(t)}):(console.warn("YaGames is not defined (running in offline/dev mode?)"),this.startGameCallback&&this.startGameCallback(null))}},{key:"showInitError",value:function(e){var t=this,n="Init error";e&&(e.message?n+=": "+e.message:n+=": "+String(e)),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){t._renderInitError(n)},{once:!0}):this._renderInitError(n)}},{key:"_renderInitError",value:function(e){var t=document.body||document.documentElement;if(t){var n=document.getElementById("debug-error-overlay");n||((n=document.createElement("div")).id="debug-error-overlay",n.className="debug_error_overlay",n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.background="rgba(0,0,0,0.85)",n.style.color="red",n.style.zIndex="9999",n.style.padding="20px",n.style.whiteSpace="pre-wrap",n.style.fontFamily="monospace",t.appendChild(n)),n.textContent=e}}},{key:"_setupGlobalErrorListeners",value:function(){var e=this;window.addEventListener("error",function(t){if(t){var n=[];t.message&&n.push(t.message),t.filename&&n.push("at "+t.filename+":"+t.lineno+":"+t.colno),t.error&&t.error.stack&&n.push(t.error.stack),e.showInitError(n.join("\n"))}}),window.addEventListener("unhandledrejection",function(t){if(t){var n=t.reason||"unhandledrejection";n.stack?e.showInitError(n.stack):e.showInitError(String(n))}})}}])}();function Z(e,t){return Math.random()*(t-e)+e}function J(){return $.apply(this,arguments)}function $(){return($=c(s().m(function e(){var t;return s().w(function(e){for(;;)switch(e.n){case 0:document.addEventListener("contextmenu",function(e){return e.preventDefault(),!1},{capture:!0}),document.addEventListener("selectstart",function(e){return e.preventDefault(),!1},{capture:!0}),document.addEventListener("dragstart",function(e){return e.preventDefault(),!1},{capture:!0}),document.addEventListener("touchstart",function(e){e.touches.length>1&&e.preventDefault()},{passive:!1}),document.addEventListener("touchstart",function(e){t=setTimeout(function(){e.preventDefault()},500)},{passive:!1}),document.addEventListener("touchend",function(){clearTimeout(t)}),document.addEventListener("touchmove",function(){clearTimeout(t)}),document.addEventListener("dblclick",function(e){return e.preventDefault(),!1},{capture:!0}),(navigator.userAgent.includes("YaBrowser")||navigator.userAgent.includes("Yandex"))&&document.addEventListener("touchstart",function(e){e.target.closest(".new_game_btn, .free_game_btn, .popup_game_btn, .popup_game_btn_close, .level_game_chels, .level_game_chels_contest, .free_game_chels, .contest_game_btn, .arrow_back, .levels_block, .sound_btn_wrap, .pause_btn_wrap, .lang-toggle, .auth_btn, .small_btn")||e.preventDefault()},{passive:!1});case 1:return e.a(2)}},e)}))).apply(this,arguments)}new i(new l(-.5,-.5,-.5),new l(.5,.5,.5)),new d;var Q=function(){return h(function e(){u(this,e),this.events={}},[{key:"on",value:function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}},{key:"off",value:function(e,t){this.events[e]&&(this.events[e]=this.events[e].filter(function(e){return e!==t}))}},{key:"emit",value:function(e,t){this.events[e]&&this.events[e].forEach(function(e){return e(t)})}}])}(),ee=function(){return h(function e(t){var n;u(this,e),this.gameContext=t,this.onWindowResize=this.onWindowResize.bind(this),this.setVhVar=this.setVhVar.bind(this),this.onVisibilitychange=this.onVisibilitychange.bind(this),this.scene=new p,this.scene.background=new f(10392058),this.camera=new m(25,window.innerWidth/window.innerHeight,.1,2e3),this.camera.position.x=0,this.camera.position.y=12,this.camera.position.z=32;var a=k.degToRad(25);this.FIXED_HFOV=2*Math.atan(Math.tan(a/2)*(16/9)),this.stats=new y,document.body.appendChild(this.stats.dom),this.stats.dom.style.top="0",this.stats.dom.style.left="0",this.renderer=new g({antialias:!0}),this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=v,this.renderer.outputColorSpace=b,this.renderer.toneMapping=w,this.renderer.toneMappingExposure=1.05,this.controls=new x(this.camera,this.renderer.domElement),this.setVhVar(),window.addEventListener("resize",this.setVhVar),window.addEventListener("orientationchange",this.setVhVar),null===(n=window.visualViewport)||void 0===n||n.addEventListener("resize",this.setVhVar),window.addEventListener("resize",this.onWindowResize),window.addEventListener("visibilitychange",this.onVisibilitychange),this.onWindowResize(),this.onVisibilitychange()},[{key:"setVhVar",value:function(){var e,t=.01*((null===(e=window.visualViewport)||void 0===e?void 0:e.height)||window.innerHeight);document.documentElement.style.setProperty("--vh","".concat(t,"px"))}},{key:"onVisibilitychange",value:function(){this.gameContext.audioClass}},{key:"onWindowResize",value:function(){var e=document.body.offsetWidth,t=document.body.offsetHeight,n=e/t,a=2*Math.atan(Math.tan(this.FIXED_HFOV/2)/n),r=k.degToRad(4),s=k.degToRad(90);a=k.clamp(a,r,s),this.camera.fov=k.radToDeg(a),this.camera.aspect=n,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}}])}(),te=function(){return h(function e(){u(this,e),this.gameInit=!1,this.isMobileDevice=this.detectDevice(),this.gameState={menu:1,play:2,pause:3},this.currentGameState=this.gameState.menu},[{key:"setGameState",value:function(e){this.currentGameState=e}},{key:"goToMenu",value:function(){this.setGameState(this.gameState.menu)}},{key:"startGame",value:function(){this.setGameState(this.gameState.play)}},{key:"pauseGame",value:function(){this.setGameState(this.gameState.pause)}},{key:"resumeGame",value:function(){this.setGameState(this.gameState.play)}},{key:"detectDevice",value:function(){var e=window.matchMedia||window.msMatchMedia;return!!e&&e("(pointer:coarse)").matches}},{key:"initCustomScroll",value:function(){var e=[".free_game_screen",".levels_game_screen",".levels_game_screen_contest",".main_screen"],t=null,n=null,a=null,r=!1,s=0,o=0,i=function(){var r=function(){for(var t=0,n=e;t<n.length;t++){var a=n[t],r=document.querySelector(a);if(r&&!r.classList.contains("hidden_screen"))return r}return null}();r!==t&&(t&&t.removeEventListener("scroll",c,{passive:!0}),a&&(a.removeEventListener("mousedown",u),a.removeEventListener("touchstart",u)),n=(t=r)?t.querySelector(".scroll-progress"):null,a=n?n.querySelector(".scroll-progress__bar"):null,t&&t.addEventListener("scroll",c,{passive:!0}),a&&(a.addEventListener("mousedown",u),a.addEventListener("touchstart",u)),c())},c=function(){if(t&&n&&a){var e=t.clientHeight,r=t.scrollHeight,s=t.scrollTop;if(r<=e+1)n.classList.remove("visible");else{n.classList.add("visible");var o=n.getBoundingClientRect().height,i=Math.max(e/r*o,24),c=r-e,u=c>0?s/c*(o-i):0;a.style.height="".concat(i,"px"),a.style.top="".concat(u,"px")}}},u=function(e){t&&a&&(r=!0,s=e.touches?e.touches[0].clientY:e.clientY,o=t.scrollTop,document.body.style.userSelect="none",e.preventDefault())},l=function(e){if(r&&t&&a&&n){var i=(e.touches?e.touches[0].clientY:e.clientY)-s,c=n.getBoundingClientRect().height,u=t.clientHeight,l=(t.scrollHeight-u)/Math.max(1,c-a.offsetHeight);t.scrollTop=o+i*l}},h=function(){r=!1,document.body.style.userSelect=""};window.addEventListener("resize",function(){i(),c()}),window.addEventListener("mousemove",l,{passive:!1}),window.addEventListener("touchmove",l,{passive:!1}),window.addEventListener("mouseup",h),window.addEventListener("touchend",h),new MutationObserver(function(){i()}).observe(document.body,{attributes:!0,subtree:!0,attributeFilter:["class"]}),i()}}])}(),ne=function(){return h(function e(){u(this,e),this.takeAudio,this._attached=!1,this.listener=new _,this.musicOn=!0,this.musics=[]},[{key:"hardStopAll",value:function(){this.musics.forEach(function(e){var t=e.music;try{t.stop()}catch(n){}}),this.quacks.forEach(function(e){try{e.stop()}catch(t){}}),this.thundersAudio.forEach(function(e){try{e.music.stop()}catch(t){}}),this.musicNowPlaying=[]}},{key:"toggleMute",value:function(e){e?(this.musicOn=!1,this.listener.context.suspend()):(this.musicOn=!0,this.listener.context.resume(),this.playMusic(["back"]))}},{key:"isMuted",value:function(){return"suspended"===this.listener.context.state}},{key:"attachTo",value:function(e){this._attached||(e.add(this.listener),this._attached=!0)}},{key:"loadAudio",value:(e=c(s().m(function e(){var t,n,a=this;return s().w(function(e){for(;;)switch(e.n){case 0:return t=new E,n=[{key:"takeAudio",name:"take",path:"audio/take.mp3",loop:!1,ref:200,vol:2}],e.n=1,Promise.all(n.map(function(e){return t.loadAsync(e.path).catch(function(t){return console.error("Ошибка при загрузке ".concat(e.path,":"),t),null})}));case 1:e.v.forEach(function(e,t){var r=n[t];if(e){var s=new C(a.listener);s.setBuffer(e),s.setLoop(r.loop),s.setRefDistance(r.ref),s.setVolume(r.vol),r.rate&&s.setPlaybackRate(r.rate),a[r.key]=s,a.musics.push({name:r.name,music:s})}});case 2:return e.a(2)}},e)})),function(){return e.apply(this,arguments)})},{key:"stopMusic",value:function(e){var t=this;this.musicOn&&(0==e?this.musics.forEach(function(e,t,n){e.music.stop()}):e.forEach(function(e,n,a){t.musics.find(function(t){return t.name===e}).music.stop()}))}},{key:"pauseMusic",value:function(e){var t=this;this.musicOn&&e.forEach(function(e,n,a){t.musics.find(function(t){return t.name===e}).music.pause()})}},{key:"playMusic",value:function(e){var t=this;e.forEach(function(e,n,a){var r=t.musics.find(function(t){return t.name===e}).music;!r.isPlaying&&t.musicOn&&r.play()})}},{key:"togglePauseAll",value:function(e){var t=this;this.musicOn&&(e?(this.musicNowPlaying=[],this.musics.forEach(function(e){var n=e.music;n.isPlaying&&(n.pause(),t.musicNowPlaying.push(n))})):this.musicNowPlaying&&this.musicNowPlaying.length&&(this.musicNowPlaying.forEach(function(e){e.isPlaying||e.play()}),this.musicNowPlaying=[]))}}]);var e}(),ae=function(){return h(function e(t){u(this,e),this.renderer=t.renderer,this.camera=t.camera,this.events=t.events,this.mouse=new l,this.raycaster=new S,this.onTapDown=this.onTapDown.bind(this),this.onTapUp=this.onTapUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this)},[{key:"addKeyListeners",value:(e=c(s().m(function e(){var t;return s().w(function(e){for(;;)switch(e.n){case 0:t=this.renderer.domElement,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),t.addEventListener("mousedown",this.onKeyDown),t.addEventListener("mouseup",this.onKeyUp),t.addEventListener("touchstart",this.onTapDown,{passive:!1}),t.addEventListener("touchend",this.onTapUp);case 1:return e.a(2)}},e,this)})),function(){return e.apply(this,arguments)})},{key:"removedKeyListeners",value:function(){var e=this.renderer.domElement;window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),e.removeEventListener("mousedown",this.onKeyDown),e.removeEventListener("mouseup",this.onKeyUp),e.removeEventListener("touchstart",this.onTapDown),e.removeEventListener("touchend",this.onTapUp)}},{key:"onTapDown",value:function(e){var t=this.renderer.domElement.getBoundingClientRect();e=e.changedTouches[0],this.mouse.x=(e.clientX-t.left)/t.width*2-1,this.mouse.y=-(e.clientY-t.top)/t.height*2+1,this.raycaster.setFromCamera(this.mouse,this.camera)}},{key:"onTapUp",value:function(e){var t=this.renderer.domElement.getBoundingClientRect();e=e.changedTouches[0],this.mouse.x=(e.clientX-t.left)/t.width*2-1,this.mouse.y=-(e.clientY-t.top)/t.height*2+1,this.raycaster.setFromCamera(this.mouse,this.camera)}},{key:"onKeyDown",value:function(e){switch(e.code){case"KeyW":case"ArrowUp":this.events.emit("player_forward",1);break;case"KeyS":case"ArrowDown":this.events.emit("player_backward",1);break;case"KeyA":case"ArrowLeft":this.events.emit("player_left",1);break;case"KeyD":case"ArrowRight":this.events.emit("player_right",1)}}},{key:"onKeyUp",value:function(e){switch(e.code){case"KeyW":case"ArrowUp":this.events.emit("player_forward",0);break;case"KeyS":case"ArrowDown":this.events.emit("player_backward",0);break;case"KeyA":case"ArrowLeft":this.events.emit("player_left",0);break;case"KeyD":case"ArrowRight":this.events.emit("player_right",0)}}}]);var e}(),re={ru:{ui:{langToggle:"EN"},title:"Шаблон",btn1:"Кнопка 1",settings:"Настройки",back:"Назад",start_game_btn:"Начать игру"},en:{ui:{langToggle:"RU"},title:"Template",btn1:"btn1",settings:"settings",back:"back",start_game_btn:"Start Game"}};function se(e,t){return t.split(".").reduce(function(e,t){return e&&e[t]},e)}function oe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ru",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document,n=re[e]||re.ru;if(t.querySelectorAll("[data-i18n]").forEach(function(e){var t=e.dataset.i18n,a=se(n,t);null!=a&&(e.textContent=a)}),document.documentElement.lang=e,localStorage.setItem("locale",e),document.getElementById("lang-toggle")){var a=document.getElementById("flag");"ru"===se(n,"ui.langToggle")||"ru"===e?(a.classList.remove("us"),a.classList.add("ru"),a.src="images/ru.svg"):(a.classList.remove("ru"),a.classList.add("us"),a.src="images/us.svg")}}function ie(e){oe(e);var t=document.getElementById("lang-toggle");document.getElementById("flag"),t&&t.addEventListener("click",function(){oe("ru"===(localStorage.getItem("locale")||"ru")?"en":"ru")})}var ce=function(){return h(function e(t){u(this,e),this.events=t.events,this.yandexPlayer={id:0,player:null,isAuthorized:!1}},[{key:"clearData",value:(a=c(s().m(function e(){return s().w(function(e){for(;;)switch(e.n){case 0:localStorage.clear();case 1:return e.a(2)}},e)})),function(){return a.apply(this,arguments)})},{key:"initYandexPlayer",value:(n=c(s().m(function e(){var t,n,a=arguments;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=(a.length>0&&void 0!==a[0]?a[0]:{}).force,n=void 0!==t&&t,e.p=1,this.yandexPlayer.player&&!n){e.n=3;break}if("undefined"==typeof ysdk){e.n=3;break}return e.n=2,ysdk.getPlayer();case 2:this.yandexPlayer.player=e.v;case 3:if(!this.yandexPlayer.player){e.n=5;break}return e.n=4,this.yandexPlayer.player.isAuthorized();case 4:this.yandexPlayer.isAuthorized=e.v;case 5:e.n=7;break;case 6:e.p=6,e.v,this.yandexPlayer.isAuthorized=!1;case 7:this.events.emit("player_auth_checked",this.yandexPlayer.isAuthorized),this.yandexPlayer.isAuthorized&&console.log("DataClass: авторизовались");case 8:return e.a(2)}},e,this,[[1,6]])})),function(){return n.apply(this,arguments)})},{key:"loadTableFromCloud",value:(t=c(s().m(function e(){var t,n;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,this.initYandexPlayer();case 1:return e.p=1,e.n=2,this.yandexPlayer.player.getData(["table"]);case 2:if(!(t=e.v)||!t.table||"object"!==r(t.table)){e.n=3;break}this.table=t.table,e.n=4;break;case 3:return console.log("Первый вход: создаём новую table"),this.table=this.createDefaultTable(),e.n=4,this.saveTableToCloud();case 4:e.n=6;break;case 5:e.p=5,n=e.v,console.warn("Cloud load failed:",n),this.table=this.createDefaultTable();case 6:return e.a(2)}},e,this,[[1,5]])})),function(){return t.apply(this,arguments)})},{key:"createDefaultTable",value:function(){return{updateDate:Date.now(),player:{levels:[0,0,0],bonusHat:[!1,!1,!1]}}}},{key:"saveTableToCloud",value:(e=c(s().m(function e(){var t,n,a,r=arguments;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=(r.length>0&&void 0!==r[0]?r[0]:{}).flush,n=void 0!==t&&t,e.n=1,this.initYandexPlayer();case 1:return e.p=1,e.n=2,this.yandexPlayer.player.setData({},n);case 2:e.n=4;break;case 3:e.p=3,a=e.v,console.warn("Cloud save failed:",a);case 4:return e.a(2)}},e,this,[[1,3]])})),function(){return e.apply(this,arguments)})}]);var e,t,n,a}(),ue=function(){return h(function e(){u(this,e),this.planeGrass={texture:null,material:null},this.model=null},[{key:"loadTextures",value:(t=c(s().m(function e(){var t,n,r,o;return s().w(function(e){for(;;)switch(e.n){case 0:return t=new L,e.n=1,Promise.all([t.loadAsync("textures/grass.jpg")]);case 1:n=e.v,r=a(n,1),o=r[0],this.planeGrass.texture=o,this.planeGrass.material=new P({map:o});case 2:return e.a(2)}},e,this)})),function(){return t.apply(this,arguments)})},{key:"loadModels",value:(e=c(s().m(function e(){var t,n=this;return s().w(function(e){for(;;)switch(e.n){case 0:return t=new M,e.n=1,t.loadAsync("models/model.glb").then(function(e){var t=e.scene,a=e.animations;t.scale.x=2,t.scale.y=2,t.scale.z=2,t.position.y=0,t.rotation.y=-Math.PI/3,n.model=t,n.model.userData.mixer=new O(n.model),n.model.userData.action=n.model.userData.mixer.clipAction(a[0]),n.model.userData.action.play(),n.model.userData.clock=new j});case 1:return e.a(2)}},e)})),function(){return e.apply(this,arguments)})}]);var e,t}(),le=function(){return h(function e(t){var n=this;u(this,e),this.events=t.events,this.screens=document.querySelectorAll(".screen"),this.currentScreen=null,document.querySelector("body").addEventListener("click",function(e){var a=e.target.closest(".btn");if(a)switch(a.dataset.action){case"newGame":t.ui.show("free_game_screen");break;case"settings":t.ui.show("settings_screen");break;case"back":t.ui.show("main_screen");break;case"start_game_btn":t.ui.hideAll(),n.events.emit("start_match",!0)}}),this.initListeners()},[{key:"initListeners",value:function(){var e=this;this.events.on("player_auth_checked",function(t){e.updateAuthUI(t)})}},{key:"updateAuthUI",value:function(e){var t=document.querySelector(".autoriz");t&&(t.classList.toggle("hidden_screen",!0===e),!0===e?(t.setAttribute("aria-hidden","true"),t.style.display="none"):(t.setAttribute("aria-hidden","false"),t.style.display=""))}},{key:"show",value:function(e){var t=document.getElementById(e);t?(this.screens.forEach(function(e){return e.classList.remove("active")}),t.classList.add("active"),this.currentScreen=e):console.warn("Screen ".concat(e," not found"))}},{key:"hideAll",value:function(){this.screens.forEach(function(e){return e.classList.remove("active")}),this.currentScreen=null}}])}(),he=function(){return h(function e(t){u(this,e),this.scene=t.scene,this.ground=null,this.options={size:{w:10,h:10,d:.2},name:"ground"}},[{key:"loadMesh",value:function(){var e=new I(this.options.size.w,this.options.size.h,this.options.size.d),n=new A({color:10392058,side:D});this.ground=new G(e,n),this.ground.userData=t({},this.options),this.ground.rotateX(Math.PI/2),this.ground.receiveShadow=!0}}])}(),de=function(){return h(function e(t){u(this,e),this.scene=t.scene,this.dirLight=null,this.ambientLight=null},[{key:"loadLight",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.ambientLight=new T(16777215,1),this.dirLight=new R(16777215,1),this.dirLight.position.set(-3,5,1),this.dirLight.castShadow=!0,this.dirLight.shadow.camera.far=100,e&&this.scene.add(this.ambientLight),t&&this.scene.add(this.dirLight)}}])}(),pe=function(){return h(function e(a){var r=this;u(this,e),n(this,"setEmotion",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"neutral",a=r.emotions[e]||{},s=r.defaults.mouth,o=a.mouth||{},i=t({},s);"half"===o.shape&&(i.thetaLength=Math.PI),"full"===o.shape&&(i.thetaLength=2*Math.PI),void 0!==o.open&&(i.openEnded=o.open);["radiusTop","radiusBottom","height","radialSegments","heightSegments","openEnded","thetaStart","thetaLength"].forEach(function(e){void 0!==o[e]&&(i[e]=o[e])}),r.updateMouthGeometry(i);var c="back.out(1.7)";if(["bodyRotate","color"].forEach(function(e){var t,s,o=(t=r.defaults[e],void 0===(s=a[e])?t:"string"==typeof t?s:t+s);W.to(r.params,n(n(n({},e,o),"duration",1.2),"ease",c))}),["eyes","brows","cheeks"].forEach(function(e){Object.keys(r.defaults[e]).forEach(function(t){var n=r.defaults[e][t],s=a[e]&&a[e][t]?a[e][t]:[0,0];W.to(r.params[e][t],{0:n[0]+s[0],1:n[1]+s[1],duration:1.2,ease:c,onUpdate:function(){return r.updateCharacterVisuals()}})})}),r.defaults.mouth){var u=r.defaults.mouth,l=a.mouth||{},h={};["x","y","scaleX","scaleY","rotationX","rotationY"].forEach(function(e){h[e]=u[e]+(l[e]||0)}),W.to(r.params.mouth,t(t({},h),{},{duration:1.2,ease:c,onUpdate:function(){return r.updateCharacterVisuals()}}))}}),this.scene=a.scene,this.gui=a.gui,this.characterGroup=new Y,this.eyes=[],this.brows=[],this.cheeks=[],this.mouth=null,this.currentMouthParams={},this.faceZ=.62,this.bodyMat=new P({color:9364655,roughness:.9}),this.body=null,this.heightBody=4.2,this.blackMat=new P({color:7556154,side:D}),this.defaults={bodyRotate:0,color:"#8EE4AF",eyes:{x:[-.4,.4],y:[1.2,1.2],scaleX:[1,1],scaleY:[1,1]},brows:{x:[-.4,.4],y:[1.5,1.5],rotation:[0,0]},cheeks:{x:[-.5,.5],y:[.9,.9],scaleX:[1,1],scaleY:[2,2],opacity:[.4,.4]},mouth:{x:0,y:.6,scaleX:-.1,scaleY:1.101,rotationX:-Math.PI/2,rotationZ:-Math.PI/2,radiusTop:.1,radiusBottom:.12,height:.05,radialSegments:12,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:2.9}},this.initialDefaults=JSON.parse(JSON.stringify(this.defaults)),this.params=JSON.parse(JSON.stringify(this.defaults)),this.emotionsSmile={neutral:{mouth:{}},smile:{brows:{y:[.05,.05]},mouth:{thetaLength:Math.PI,scaleX:.2,scaleY:.5}},laugh:{bodyRotate:.1,eyes:{scaleY:[-.8,-.8]},brows:{y:[.2,.2]},mouth:{thetaLength:Math.PI,scaleX:.5,scaleY:1}},excited:{bodyRotate:-.2,eyes:{scaleY:[.3,.3],scaleX:[.2,.2]},brows:{y:[.3,.3]},mouth:{thetaLength:Math.PI,scaleX:.6,scaleY:1.2,openEnded:!1}},proud:{bodyRotate:0,eyes:{scaleY:[-.85,-.85]},brows:{y:[.2,.2]},mouth:{thetaLength:Math.PI,scaleX:.4,scaleY:.4,y:.1}}},this.emotionsIdle={idle_breathe:{bodyRotate:.02,mouth:{scaleX:.05,scaleY:.02}},idle_left:{eyes:{x:[-.08,-.08]},brows:{x:[-.05,-.05]},mouth:{x:-.02}},idle_right:{eyes:{x:[.08,.08]},brows:{x:[.05,.05]},mouth:{x:.02}},idle_focus:{eyes:{scaleY:[-.15,-.15]},brows:{y:[-.05,-.05]},mouth:{scaleX:-.1}},idle_alert:{bodyRotate:-.05,eyes:{scaleY:[.1,.1]},brows:{y:[.1,.1]},mouth:{scaleY:-.1}},idle_hm:{bodyRotate:.05,brows:{y:[0,.15]},mouth:{rotationX:.1}},idle_chill:{eyes:{scaleY:[-.05,-.05]},brows:{rotation:[.1,-.1]},mouth:{scaleX:.05}},idle_tilt:{bodyRotate:-.15,eyes:{x:[.02,.02]}},idle_low:{bodyRotate:.05,brows:{y:[-.05,-.05],rotation:[-.1,.1]},mouth:{y:-.05}},idle_check:{eyes:{x:[.05,.05],scaleY:[-.1,-.1]},brows:{y:[.05,.05]},mouth:{scaleX:-.15}}},this.emotions=this.emotionsIdle,this.setupGui(),setInterval(function(){var e=Object.keys(r.emotions),t=e[Math.floor(Math.random()*e.length)];r.setEmotion(t),console.log("Current Emotion:",t)},Z(1500,4e3)),setInterval(function(){r.blink()},Z(2e3,4e3))},[{key:"updateMouthGeometry",value:function(e){for(var n=!1,a=0,r=["radiusTop","radiusBottom","height","radialSegments","heightSegments","openEnded","thetaStart","thetaLength"];a<r.length;a++){var s=r[a];if(this.currentMouthParams[s]!==e[s]){n=!0;break}}if(n||!this.mouth){this.mouth&&this.mouth.geometry&&this.mouth.geometry.dispose();var o=new z(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength);o.rotateX(Math.PI/2),o.center(),this.mouth?this.mouth.geometry=o:(this.mouth=new G(o,this.blackMat),this.characterGroup.add(this.mouth)),this.currentMouthParams=t({},e)}}},{key:"blink",value:function(){var e=this;if(!(this.eyes.length<2)){var t={val:1};W.to(t,{val:.1,duration:.1,yoyo:!0,repeat:1,ease:"power1.inOut",onUpdate:function(){e.eyes.forEach(function(n,a){n.scale.setY(e.params.eyes.scaleY[a]*t.val)})}})}}},{key:"loadCharacters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.defaults.color,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.scene.add(this.characterGroup),this.savedScaleY=t,this.body=new G(new X(1.5,this.heightBody*t,1.2,8,.3),this.bodyMat),this.body.position.y=this.heightBody*t/2-2.2,this.body.material.color.set(e),this.body.castShadow=!0,this.body.receiveShadow=!0,this.characterGroup.add(this.body);var n=new V({color:16751001,transparent:!0,opacity:.7}),a=new z(.12,.12,.05,32);a.rotateX(Math.PI/2);for(var r=0;r<2;r++){var s=new G(a,this.blackMat);this.characterGroup.add(s),this.eyes.push(s)}for(var o=new B(.08,.025,16,30,Math.PI/1.1),i=0;i<2;i++){var c=new G(o,this.blackMat);this.characterGroup.add(c),this.brows.push(c)}this.updateMouthGeometry(this.defaults.mouth);var u=new K(.18,32,16);u.scale(1,.6,.2);for(var l=0;l<2;l++){var h=new G(u,n);this.characterGroup.add(h),this.cheeks.push(h)}this.updateCharacterVisuals(),W.to(this.characterGroup.scale,{duration:Z(1.7,2.3),y:"+=0.03",repeat:-1,yoyo:!0,ease:"sine.inOut"})}},{key:"updateCharacterVisuals",value:function(e){var t=this.savedScaleY||1,n=this.heightBody*t/2-2.2,a=Math.max(t,.65),r=this.heightBody*t/2,s=function(e){return n+r-(2.1-e)*a};this.characterGroup.rotation.y=this.params.bodyRotate;for(var o=0;o<2;o++)this.eyes[o].position.set(this.params.eyes.x[o]*a,s(this.params.eyes.y[o]),this.faceZ),this.eyes[o].scale.set(this.params.eyes.scaleX[o]*a,this.params.eyes.scaleY[o]*a,1),this.brows[o].position.set(this.params.brows.x[o]*a,s(this.params.brows.y[o]),this.faceZ),this.brows[o].rotation.z=this.params.brows.rotation[o],this.cheeks[o].position.set(this.params.cheeks.x[o]*(1.1*a),s(this.params.cheeks.y[o]),this.faceZ),this.cheeks[o].scale.set(this.params.cheeks.scaleX[o]*a,.6*this.params.cheeks.scaleY[o]*a,.2),void 0!==this.cheeks[o].material.opacity&&(this.cheeks[o].material.opacity=this.params.cheeks.opacity[o]);this.mouth&&(this.mouth.position.set(this.params.mouth.x,s(this.params.mouth.y),this.faceZ),this.mouth.rotation.x=this.params.mouth.rotationX,this.mouth.rotation.z=this.params.mouth.rotationZ,this.mouth.scale.set(this.params.mouth.scaleX*a,this.params.mouth.scaleY*a,1))}},{key:"setupGui",value:function(){var e=this;if(this.gui){var t=function(){e.applyGuiToParams(),e.updateCharacterVisuals(),e.logChanges()},n=function(){e.applyGuiToParams(),e.updateMouthGeometry(e.params.mouth),e.logChanges()},a=this.gui.addFolder("Person");a.add(this.defaults,"bodyRotate",-3,3).onChange(t),a.addColor(this.defaults,"color").onChange(t);var r=function(n,a){var r=e.gui.addFolder(n);r.add(a.x,"0",-1,0).name("Left X").onChange(t),r.add(a.x,"1",0,1).name("Right X").onChange(t),r.add(a.y,"0",0,3).name("Left Y").onChange(t),r.add(a.y,"1",0,3).name("Right Y").onChange(t),a.rotation&&(r.add(a.rotation,"0",-3,3).name("Left Rot").onChange(t),r.add(a.rotation,"1",-3,3).name("Right Rot").onChange(t)),a.scaleX?(r.add(a.scaleX,"0",0,3).name("L Scale X").onChange(t),r.add(a.scaleX,"1",0,3).name("R Scale X").onChange(t),r.add(a.scaleY,"0",0,3).name("L Scale Y").onChange(t),r.add(a.scaleY,"1",0,3).name("R Scale Y").onChange(t)):a.scale&&(r.add(a.scale,"0",0,3).name("L Scale").onChange(t),r.add(a.scale,"1",0,3).name("R Scale").onChange(t)),a.opacity&&(r.add(a.opacity,"0",0,1).name("L Opacity").onChange(t),r.add(a.opacity,"1",0,1).name("R Opacity").onChange(t))};r("Eyes",this.defaults.eyes),r("Brows",this.defaults.brows),r("Cheeks",this.defaults.cheeks);var s=this.gui.addFolder("Mouth Transform");s.add(this.defaults.mouth,"x",-1,1).onChange(t),s.add(this.defaults.mouth,"y",0,2).onChange(t),s.add(this.defaults.mouth,"scaleX",0,3).onChange(t),s.add(this.defaults.mouth,"scaleY",0,3).onChange(t),s.add(this.defaults.mouth,"rotationX",-Math.PI,Math.PI).onChange(t),s.add(this.defaults.mouth,"rotationZ",-Math.PI,Math.PI).onChange(t);var o=this.gui.addFolder("Mouth Geometry");o.add(this.defaults.mouth,"radiusTop",0,1).onChange(n),o.add(this.defaults.mouth,"radiusBottom",0,1).onChange(n),o.add(this.defaults.mouth,"height",.01,1).onChange(n),o.add(this.defaults.mouth,"radialSegments",3,64,1).onChange(n),o.add(this.defaults.mouth,"openEnded").onChange(n),o.add(this.defaults.mouth,"thetaStart",0,2*Math.PI).onChange(n),o.add(this.defaults.mouth,"thetaLength",0,2*Math.PI).onChange(n)}}},{key:"applyGuiToParams",value:function(){var e=this;["eyes","brows","cheeks"].forEach(function(t){Object.keys(e.defaults[t]).forEach(function(n){e.params[t][n]&&(e.params[t][n][0]=e.defaults[t][n][0],e.params[t][n][1]=e.defaults[t][n][1])})}),Object.keys(this.defaults.mouth).forEach(function(t){e.params.mouth[t]=e.defaults.mouth[t]}),this.params.bodyRotate=this.defaults.bodyRotate,this.params.color=this.defaults.color}},{key:"logChanges",value:function(){var e=this,t={},n=function(e){return Math.round(1e3*e)/1e3},a=this.defaults.bodyRotate-this.initialDefaults.bodyRotate;Math.abs(a)>.001&&(t.bodyRotate=n(a)),["eyes","brows","cheeks"].forEach(function(a){var r={},s=!1;Object.keys(e.defaults[a]).forEach(function(t){var o=e.defaults[a][t],i=e.initialDefaults[a][t];if(Array.isArray(o)&&Array.isArray(i)){var c=o[0]-i[0],u=o[1]-i[1];(Math.abs(c)>.001||Math.abs(u)>.001)&&(r[t]=[n(c),n(u)],s=!0)}}),s&&(t[a]=r)});var r={},s=!1,o=this.defaults.mouth,i=this.initialDefaults.mouth;["x","y","scaleX","scaleY","rotationX","rotationZ"].forEach(function(e){var t=o[e]-i[e];Math.abs(t)>.001&&(r[e]=n(t),s=!0)}),["radiusTop","radiusBottom","height","radialSegments","heightSegments","openEnded","thetaStart","thetaLength"].forEach(function(e){o[e]!==i[e]&&(r[e]="number"==typeof o[e]?n(o[e]):o[e],s=!0)}),s&&(t.mouth=r),Object.keys(t).length>0&&(console.clear(),console.log("✂️ Copy this object to 'this.emotions':"),console.log(t))}}])}(),fe=function(){return h(function e(t){u(this,e),this.scene=t.scene,this.countInst1=3,this.instancesObjs={instances1:{data:Array.from({length:this.countInst1},function(e,t){return{position:new l(0,.2,0),rotation:new U(0,0,0),scale:new l(1,1,1),size:new l(.2,.2,.2),userData:{name:"inst1",collide:null,body:null,speed:null,direction:1}}}),geometryInst1:new K(.2),materialInst1:new P({color:52224}),inst1:null}},this.instancesObjs.instances1.inst1=new F(this.instancesObjs.instances1.geometryInst1,this.instancesObjs.instances1.materialInst1,this.countInst1),this.instancesObjs.instances1.inst1.instanceMatrix.setUsage(N),this.instancesObjs.instances1.inst1.receiveShadow=!0,this.instancesObjs.instances1.inst1.castShadow=!0,this.instancesObjs.instances1.inst1.frustumCulled=!1},[{key:"init",value:function(){for(var e=0;e<this.countInst1;e++)this.instancesObjs.instances1.data[e].position.x=Z(-3,3),this.instancesObjs.instances1.data[e].position.z=Z(-3,3),this.instancesObjs.instances1.data[e].position.y=Z(1,2);this.instancesObjs.instances1.inst1.instanceMatrix.needsUpdate=!0}},{key:"toVec3",value:function(e){var t,n,a;return"number"==typeof e?new l(e,e,e):null!=e&&e.isVector3?e:e?new l(null!==(t=e.x)&&void 0!==t?t:1,null!==(n=e.y)&&void 0!==n?n:1,null!==(a=e.z)&&void 0!==a?a:1):new l(1,1,1)}}])}();console.clear();var me={};function ye(){return(ye=c(s().m(function e(t){var n;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,ge();case 1:e.n=3;break;case 2:e.p=2,n=e.v,window.showInitError?window.showInitError(n):console.error("Init error",n);case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function ge(){return ve.apply(this,arguments)}function ve(){return(ve=c(s().m(function e(){var t;return s().w(function(e){for(;;)switch(e.n){case 0:return(t=document.querySelector(".loader_line"))&&(t.style.width="30%"),e.n=1,xe();case 1:return e.n=2,_e();case 2:t&&(t.style.width="100%"),me.paramsClass.gameInit=!0,me.ui.show("main_screen"),me.events.on("start_match",function(){return be()}),be(),Se();case 3:return e.a(2)}},e)}))).apply(this,arguments)}function be(){return we.apply(this,arguments)}function we(){return(we=c(s().m(function e(){return s().w(function(e){for(;;)switch(e.n){case 0:me.ui.hideAll(),me.gameClass.loadMesh(),me.instancesClass.init(),me.worldClass.loadLight(!0,!0),me.paramsClass.startGame();case 1:return e.a(2)}},e)}))).apply(this,arguments)}function xe(){return ke.apply(this,arguments)}function ke(){return(ke=c(s().m(function e(){return s().w(function(e){for(;;)switch(e.n){case 0:me.initClass=new ee(me),me.events=new Q,me.scene=me.initClass.scene,me.camera=me.initClass.camera,me.renderer=me.initClass.renderer,me.gui=new H,me.ui=new le(me),me.paramsClass=new te(me),me.assetsManager=new ue(me),me.audioClass=new ne(me),me.dataClass=new ce(me),me.controlClass=new ae(me),me.gameClass=new he(me),me.worldClass=new de(me),me.instancesClass=new fe(me),me.charactersClass1=new pe(me),me.charactersClass2=new pe(me),me.charactersClass3=new pe(me),me.charactersClass4=new pe(me),me.charactersClass1.characterGroup.position.x=-3,me.charactersClass2.characterGroup.position.x=-1,me.charactersClass3.characterGroup.position.x=1,me.charactersClass4.characterGroup.position.x=3;case 1:return e.a(2)}},e)}))).apply(this,arguments)}function _e(){return Ee.apply(this,arguments)}function Ee(){return(Ee=c(s().m(function e(){return s().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,J();case 1:return me.paramsClass.initCustomScroll(),ie("ru"),e.n=2,me.assetsManager.loadTextures();case 2:return e.n=3,me.charactersClass1.loadCharacters("#FEAEAA",.3);case 3:return e.n=4,me.charactersClass2.loadCharacters("#C0AFED",.5);case 4:return e.n=5,me.charactersClass3.loadCharacters("#A4E5BD",.7);case 5:return e.n=6,me.charactersClass4.loadCharacters("#FCE26E");case 6:return e.n=7,me.audioClass.loadAudio();case 7:return e.n=8,me.controlClass.addKeyListeners();case 8:"localhost"===location.hostname&&me.gui.addFolder("Physics");case 9:return e.a(2)}},e)}))).apply(this,arguments)}function Ce(e){me.paramsClass&&(me.paramsClass.currentGameState,me.paramsClass.gameState.play)}function Se(){var e=0,t=1/60;me.renderer.setAnimationLoop(function(){var n=me.clock.getDelta();n>.1&&(n=.1),e+=n;for(var a=5;e>=t&&a>0;)Ce(),e-=t,a--;e>t&&(e=0),me.initClass&&me.initClass.stats&&me.initClass.stats.update(),me.renderer&&me.scene&&me.camera&&me.renderer.render(me.scene,me.camera)})}me.clock=new j;var Le=new q(function(e){return ye.apply(this,arguments)});Le.init()}}})}();
